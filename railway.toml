[build]
builder = "NIXPACKS"
buildCommand = "npm run build"

[deploy]
startCommand = "node .next/standalone/server.js"
healthcheckPath = "/api/health"
healthcheckTimeout = 300
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[[services]]
name = "stablekraft-app"

[services.variables]
NODE_ENV = "production"
NEXT_TELEMETRY_DISABLED = "1"

[[services]]
name = "postgres"
plugin = "postgresql"

[services.variables]
POSTGRES_DB = "stablekraft_music"
POSTGRES_USER = "stablekraft_user"